<h1>投稿一覧</h1><span><%= link_to "投稿はこちらから",new_post_path %></span>
<div class="container">
  <div class='row'>
   <div class="col-5"></div>
   <div class="col-2"><h3>検索</h3></div>
   <div class="col-5"></div>
  </div>
  <div class='row'>
    <div class="col-2"></div>
    <div class="col-8">
      <%= form_with url:posts_path, local: true, method: :get do |f| %>
        <div class="d-flex">
          <div>性別</div>

            <div><%= f.radio_button :is_sex, "man" %>男性</div>
            <div style="margin: 0 10px 0 0;"><%= f.radio_button :is_sex, "woman" %>女性</div>

          <div>求めるレベル</div>
          <div id="level" class="mx-3">
            <%= f.label :level,'レベル ' %>
            <%= f.hidden_field :level, id:'level_star' %>
          </div>
          <div>場所</div>
          <div>
            <%= f.collection_select(:region_id, Region.all, :id, :name, {}, {class:"select-box", id:"item-prefecture"}) %>
          </div>
          <div><%= f.submit "検索", class: "btn-sm btn-primary" %></div>
        </div>
      <% end %>
  </div>
  <div class="col-2"></div>
</div>
</div>
  <table class="table table-striped">
    <thead>
      <tr>
        <th></th>
        <th>名前</th>
        <th>性別</th>
        <th>レベル</th>
        <th>投稿文</th>
        <th colspan="3"></th>
      </tr>
    </thead>
    <tbody>
      <% @posts.each do |post| %>
      <tr>
        <td><%= link_to image_tag(post.user.get_profile_image(100,100)) ,user_path(post.user.id) %></td>
        <td><%= link_to post.user.name,user_path(post.user.id) %></td>
        <td><%= post.user.is_sex == "man" ? '男性' : '女性' %></td>
        <td><div id="level<%= post.id%>"></td>
        <script>
    $(document).on('turbolinks:load', function() {
      let elem = document.querySelector('#level<%= post.id%>');
      if (elem == null) return;
      elem.innerHTML = "";
      let opt = {
        size      : 36,
        starOff   : '<%= asset_path('star-off.png') %>',
        starOn    : '<%= asset_path('star-on.png') %>',
        half      : false,
        readOnly: true,
        score: <%= post.level %>,
      }
      raty(elem, opt);
    });
    </script>
    </div>
        <td><%= link_to post.text,post_path(post.id) %></td>
      #部分テンプレートにした箇所(部分的に更新したい箇所)
　　    <td id="favorite_buttons_<%= post.id %>">
　　      <%= render "public/favorites/favorites", post: post %>
　　    </td>
　　    <td id="comment_counter">
          <%= render "public/comments/counter", post: post %>
        </td>
        <td>コメント数: <%= post.comments.count %></td>
      </tr>
      <% end %>
    </tbody>
  </table>

  <script>
  $(document).on('turbolinks:load', function() {
    let elem = document.querySelector('#level');
    if (elem == null) return;
    elem.innerHTML = "";
    let opt = {
      starOn: "<%= asset_path('star-on.png') %>",
      starOff: "<%= asset_path('star-off.png') %>",
      scoreName: 'level',
    };
    raty(elem, opt);
  });
</script>