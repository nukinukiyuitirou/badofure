<div class='container px-5 px-sm-0'>
  <div class='row'>""</div>
  <div class='row'>
    <div class='col-md-2'></div>
    <div class='col-md-3'>
      <table class='table'>
        <tr><%= image_tag @user.get_profile_image(100,100) %></tr>
        <tr>
          <th>follows</th>
          <th><%= link_to @user.followings.count, user_followings_path(@user) %></th>
        </tr>
        <tr>
          <th>followers</th>
          <th><%= link_to @user.followers.count, user_followers_path(@user) %></th>
        </tr>
        <tr>
          <td><% if current_user != @user %>
                <% if current_user.following?(@user) %>
                  <%= link_to "フォロー外す", user_relationship_path(@user.id), method: :delete, class: "btn btn-danger" %>
                <% else %>
                  <%= link_to "フォローする", user_relationship_path(@user.id), method: :post, class:"btn btn-success" %>
                <% end %>
              <% end %>
          </td>
        </tr>
      </table>
    </div>
    <div class='col-md-7'>
      <table class='table2'>
        <tr>
      	  <th>名前</th>
      	  <th><%= @user.name %></th>
        </tr>
        <tr>
          <th>レベル</th>
          <th>
            <div id="level<%= @user.id%>"></th>
            <script>
            $(document).on('turbolinks:load', function() {
              let elem = document.querySelector('#level<%= @user.id%>');
              if (elem == null) return;
              elem.innerHTML = "";
              let opt = {
                size      : 36,
                starOff   : '<%= asset_path('star-off.png') %>',
                starOn    : '<%= asset_path('star-on.png') %>',
                half      : false,
                readOnly: true,
                score: <%= @user.level %>,
              }
              raty(elem, opt);
            });
            </script>
          </th>
        </tr>
        <tr>
      	  <th>得意なショット</th>
      	  <th><%= @user.shot %></th>
        </tr>
        <tr>
      	  <th>性別</th>
      	  <th><%= @user.is_sex == "man" ? '男性' : '女性' %></th>
        </tr>
        <tr>
      	  <th>活動拠点</th>
      	  <th><%= @user.region.name %></th>
        </tr>
        <tr>
      	  <th>自己紹介</th>
      	  <th><%= @user.introduction %></th>
        </tr>
        <tr>
          <%= link_to "ユーザーのいいね一覧",favorites_user_path(@user) %>
          <% if current_user == @user && !@user.guest_user? %>
            <th><%= link_to "編集する",edit_user_path(@user),class: "btn btn-info" %></th>
            <th><%= link_to "退会する", user_users_unsubscrites_path(@user),method: :patch, class:"btn btn-danger" %></th>
          <% end %>
          <th>
            <% unless @user.id == current_user.id %>
              <% if @is_room == true %>
                <%= link_to 'メッセージへ', room_path(@room_id) %>
              <% else %>
                <%= form_with model: @room do |f| %>
                  <%= f.fields_for @entry do |e| %>
                    <% e.hidden_field :user_id, value: @user.id %>
                  <% end %>
                  <%= f.button type: :submit do %>
                    メッセージを送る
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          </th>
        </tr>
      </table>
      </div>
      </div>
      </div>
      </div>
      <tr>
      <h1><%= @user.name %>さんの過去の投稿</h1>
      <table class="table table-striped">
        <thead>
          <tr>
            <th></th>
            <th>名前</th>
            <th>性別</th>
            <th>レベル</th>
            <th>投稿文</th>
            <th colspan="3"></th>
          </tr>
        </thead>
       <tbody>
        <% @user.posts.each do |post| %>
          <tr>
            <td><%= link_to image_tag(post.user.get_profile_image(100,100)) ,user_path(post.user.id) %></td>
            <td><%= link_to post.user.name,user_path(post.user.id) %></td>
            <td><%= post.user.is_sex == "man" ? '男性' : '女性' %></td>
            <td><div id="level<%= post.id%>"></div></td>
            <script>
              $(document).on('turbolinks:load', function() {
                let elem = document.querySelector('#level<%= post.id%>');
                if (elem == null) return;
                elem.innerHTML = "";
                let opt = {
                  size      : 36,
                  starOff   : '<%= asset_path('star-off.png') %>',
                  starOn    : '<%= asset_path('star-on.png') %>',
                  half      : false,
                  readOnly: true,
                  score: <%= post.level %>,
                }
                raty(elem, opt);
              });
            </script>
            <td><%= link_to post.text,post_path(post.id) %></td>
            <td>
              <% if post.favorited_by?(current_user) %>
                <%= link_to post_favorite_path(post), method: :delete do %>
                  <i class="fas fa-heart" aria-hidden="true" style="color: red;"></i>
                  <%= post.favorites.count %>
                <% end %>
              <% else %>
                <%= link_to post_favorite_path(post), method: :post do %>
                  <i class="fas fa-heart" aria-hidden="true"></i>
                  <%= post.favorites.count %>
                <% end %>
              <% end %>
            </td>
            <td>コメント数: <%= post.comments.count %></td>
          </tr>
        <% end %>
        </tbody>
      </table>

